<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="NLP-for-Task-Classification">Notebook<a class="anchor-link" href="#NLP-for-Task-Classification">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Hypothesis</strong>: Part of Speech (POS) tagging and syntactic dependency parsing provides valuable information for classifying imperative phrases. The thinking is that being able to detect imperative phrases will transfer well to detecting tasks and to-dos.</p>
<h4 id="Some-Terminology">Some Terminology<a class="anchor-link" href="#Some-Terminology">&#182;</a></h4><ul>
<li><a href="https://en.wikipedia.org/wiki/Imperative_mood"><em>Imperative mood</em></a> is "used principally for ordering, requesting or advising the listener to do (or not to do) something... also often used for giving instructions as to how to perform a task."</li>
<li><em>Part of speech (POS)</em> is a way of categorizing a word based on its syntactic function.<ul>
<li>The POS tagger from Spacy.io that is used in this notebook differentiates between <a href="https://spacy.io/docs/api/annotation#pos-tagging-english"><em>pos_</em> and <em>tag_</em></a> - <em>POS (pos_)</em> refers to "coarse-grained part-of-speech" like <code>VERB</code>, <code>ADJ</code>, or <code>PUNCT</code>; and <em>POSTAG (tag_)</em> refers to "fine-grained part-of-speech" like <code>VB</code>, <code>JJ</code>, or <code>.</code>.</li>
</ul>
</li>
<li><em>Syntactic dependency parsing</em> is a way of connecting words based on syntactic relationships, <a href="https://spacy.io/docs/api/annotation#dependency-parsing-english">such as</a> <code>DOBJ</code> (direct object), <code>PREP</code> (prepositional modifier), or <code>POBJ</code> (object of preposition).<ul>
<li>Check out the dependency parse of the phrase <a href="https://demos.explosion.ai/displacy/?text=Send%20the%20report%20to%20Kyle%20by%20tomorrow&amp;model=en&amp;cpu=1&amp;cph=1">"Send the report to Kyle by tomorrow"</a> as an example.</li>
</ul>
</li>
</ul>
<h3 id="Proposed-Features">Proposed Features<a class="anchor-link" href="#Proposed-Features">&#182;</a></h3><p>The imperative mood centers around <em>actions</em>, and actions are generally represented in English using verbs. So the features are engineered to also center on the VERB:</p>
<ol>
<li><code>FeatureName.VERB</code>: Does the phrase contain <code>VERB</code>(s) of the tag form <code>VB*</code>?</li>
<li><code>FeatureName.FOLLOWING_POS</code>: Are the words following the <code>VERB</code>(s) of certain parts of speech?</li>
<li><code>FeatureName.FOLLOWING_POSTAG</code>: Are the words following the <code>VERB</code>(s) of certain POS tags?</li>
<li><code>FeatureName.CHILD_DEP</code>: Are the <code>VERB</code>(s) parents of certain syntactic dependencies?</li>
<li><code>FeatureName.PARENT_DEP</code>: Are the <code>VERB</code>(s) children of certain syntactic dependencies?</li>
<li><code>FeatureName.CHILD_POS</code>: Are the syntactic dependencies that the <code>VERB</code>(s) are children of of certain parts of speech?</li>
<li><code>FeatureName.CHILD_POSTAG</code>: Are the syntactic dependencies that the <code>VERB</code>(s) are children of of certain POS tags?</li>
<li><code>FeatureName.PARENT_POS</code>: Are the syntactic dependencies that the <code>VERB</code>(s) parent of certain parts of speech?</li>
<li><code>FeatureName.PARENT_POSTAG</code>: Are the syntactic dependencies that the <code>VERB</code>(s) parent of certain POS tags?</li>
</ol>
<p><strong>Notes:</strong></p>
<ul>
<li>Features 2-9 all depend on feature 1 between <code>True</code>; if <code>False</code>, phrase vectorization will result in all zeroes.</li>
<li>When features 2-9 are applied to actual phrases, they will append identifying informating about the feature in the form of <code>_*</code> (e.g., <code>FeatureName.FOLLOWING_POSTAG_WRB</code>).</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-and-Setup">Data and Setup<a class="anchor-link" href="#Data-and-Setup">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Building-a-recipe-corpus">Building a recipe corpus<a class="anchor-link" href="#Building-a-recipe-corpus">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I wrote and ran <code>epicurious_recipes.py</code>* to scrape Epicurious.com for recipe instructions and descriptions. I then performed some manual cleanup of the script results. Output is in <code>epicurious-pos.txt</code> and <code>epicurious-neg.txt</code>.</p>
<p>* <em>script (very) loosely based off of <a href="https://github.com/benosment/hrecipe-parse">https://github.com/benosment/hrecipe-parse</a></em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Note</strong> that deriving all negative examples in the training set from Epicurious recipe descriptions would result in negative examples that are longer and syntactically more complicated than the positive examples. This is a form of bias.</p>
<p>To (hopefully?) correct for this a bit, I will add the short movie reviews found at <a href="https://pythonprogramming.net/static/downloads/short_reviews/">https://pythonprogramming.net/static/downloads/short_reviews/</a> as more negative examples.</p>
<p>This still feels weird because we're selecting negative examples only from specific categories of text (recipe descriptions, short movie reviews) - just because they're readily available. Further, most positive examples are recipe instructions - also a specific (and not necessarily related to the main "task" category) category of text.</p>
<p>Ultimately though, this recipe corpus is a <strong>stopgap/proof of concept</strong> for a corpus more relevant to tasks later on, so I won't worry further about this for now.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">read_csv</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">random</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">+</span> <span class="s1">&#39;/data.tsv&#39;</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="s1">&#39;Label&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[3]:</div>


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Text</th>
      <th>Label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Be kind</td>
      <td>pos</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Get out of here</td>
      <td>pos</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Look this over</td>
      <td>pos</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Paul, do your homework now</td>
      <td>pos</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Do not clean soot off the window</td>
      <td>pos</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pos_data_split</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">Label</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Text</span><span class="p">)</span>
<span class="n">neg_data_split</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">Label</span> <span class="o">==</span> <span class="s1">&#39;neg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Text</span><span class="p">)</span>

<span class="n">num_pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_data_split</span><span class="p">)</span>
<span class="n">num_neg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">neg_data_split</span><span class="p">)</span>

<span class="c1"># 50/50 split between the number of positive and negative samples</span>
<span class="n">num_per_class</span> <span class="o">=</span> <span class="n">num_pos</span> <span class="k">if</span> <span class="n">num_pos</span> <span class="o">&lt;</span> <span class="n">num_neg</span> <span class="k">else</span> <span class="n">num_neg</span>

<span class="c1"># shuffle samples</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">pos_data_split</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">neg_data_split</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">pos_data_split</span><span class="p">[:</span><span class="n">num_per_class</span><span class="p">]:</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">neg_data_split</span><span class="p">[:</span><span class="n">num_per_class</span><span class="p">]:</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="s1">&#39;neg&#39;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Features as defined in the introduction</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="k">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">auto</span>
<span class="k">class</span> <span class="nc">FeatureName</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">VERB</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">FOLLOWING_POS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">FOLLOWING_POSTAG</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">CHILD_DEP</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">PARENT_DEP</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">CHILD_POS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">CHILD_POSTAG</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">PARENT_POS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">PARENT_POSTAG</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h2 id="spaCy.io-for-NLP"><a href="https://spacy.io/">spaCy.io</a> for NLP<a class="anchor-link" href="#spaCy.io-for-NLP">&#182;</a></h2><p><em>Because Stanford CoreNLP is hard to install for Python</em></p>
<p>Found Spacy through an article on <a href="https://www.microsoft.com/developerblog/2016/09/13/training-a-classifier-for-relation-extraction-from-medical-literature/">"Training a Classifier for Relation Extraction from Medical Literature"</a> (<a href="https://github.com/CatalystCode/corpus-to-graph-ml">GitHub</a>)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/assets/imgs/nlp_classifier/nltk_library_comparison.png" alt="NLTK library comparison chart https://spacy.io/docs/api/#comparison" style="width: 400px; margin: 0;"/></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="ch">#!conda config --add channels conda-forge</span>
<span class="c1">#!conda install spacy</span>
<span class="c1">#!python -m spacy download en</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h3 id="Using-the-Spacy-Data-Model-for-NLP">Using the Spacy Data Model for NLP<a class="anchor-link" href="#Using-the-Spacy-Data-Model-for-NLP">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>
<span class="c1"># slow</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Spacy's sentence segmentation is lacking... <a href="https://github.com/explosion/spaCy/issues/235">https://github.com/explosion/spaCy/issues/235</a>. So each '\n' will start a new Spacy Doc.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">create_spacy_docs</span><span class="p">(</span><span class="n">ll</span><span class="p">):</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="p">[(</span><span class="n">nlp</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">]</span>
    <span class="c1"># collapse noun phrases into single compounds</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">np</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">noun_chunks</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">tag_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ent_type_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dd</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># slower</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">create_spacy_docs</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h3 id="NLP-output">NLP output<a class="anchor-link" href="#NLP-output">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Tokenization, POS tagging, and dependency parsing happened automatically with the <code>nlp(line)</code> calls above! So let's look at the outputs.</p>
<p><a href="https://spacy.io/docs/usage/data-model">https://spacy.io/docs/usage/data-model</a> and <a href="https://spacy.io/docs/api/doc">https://spacy.io/docs/api/doc</a> will be useful going forward</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sents</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>[Transfer gazpacho to an airtight container; cover and chill until very cold, 4–12 hours.]
[Add jalapeño and salt and toss to combine.]
[Transfer to a paper-towel lined plate.]
[Season pork chops all over with salt and pepper; sprinkle with aniseed and red pepper flakes.]
[Lightly season with salt and pepper and drizzle vinaigrette over; top with walnuts and mint.]
[Slice in half diagonally and serve.]
[Lower the heat to 200°F and bake for 2 to 3 more hours, until the skin is a dark caramel brown and the top is no longer moist or sticky.]
[You could also do this on a floured surface, but the pastry is so fragile I find it easier to handle between cling film.]
[Prepare a grill for medium-high heat or heat a grill pan or cast-iron skillet over medium-high; oil grate or pan.]
[Serve or freeze in an airtight container for up to a week.]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">noun_chunks</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[12]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>[Transfer gazpacho, an airtight container, cover, chill, 4–12 hours]
[jalapeño, salt]
[Transfer, a paper-towel lined plate]
[Season pork, salt, pepper, aniseed, red pepper flakes]
[Lightly season, salt, pepper, drizzle vinaigrette, walnuts, mint]
[Slice, half]
[the heat, bake, 2 to 3 more hours, the skin, a dark caramel brown, the top]
[You, a floured surface, the pastry, I, it, film]
[a grill, medium-high heat or heat a grill pan, cast-iron skillet, medium, oil grate, pan]
[Serve, freeze, an airtight container]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://demos.explosion.ai/displacy">Spacy's dependency graph visualization</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">dep_</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lemma_</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">pos_</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">tag_</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">head</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[13]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Transfer gazpacho ROOT Transfer gazpacho NOUN NN Transfer gazpacho [to, .]
to prep to ADP IN Transfer gazpacho [an airtight container]
an airtight container pobj an airtight container NOUN NN to [;, cover, until]
; punct ; PUNCT : an airtight container []
cover conj cover NOUN NN an airtight container [and, chill]
and cc and CCONJ CC cover []
chill conj chill NOUN NN cover []
until prep until ADP IN an airtight container [cold, 4–12 hours]
very advmod very ADV RB cold []
cold pobj cold ADJ JJ until [very, ,]
...
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h3 id="Featurization">Featurization<a class="anchor-link" href="#Featurization">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>

<span class="k">def</span> <span class="nf">featurize</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">s_features</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;VB.?&#39;</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">tag_</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># note: not using token.pos == VERB because this also includes BES, HVS, MD tags </span>
            <span class="n">s_features</span><span class="p">[</span><span class="n">FeatureName</span><span class="o">.</span><span class="n">VERB</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># FOLLOWING_POS</span>
            <span class="c1"># FOLLOWING_POSTAG</span>
            <span class="n">next_idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span> <span class="n">next_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.FOLLOWING_POS.name}</span><span class="s1">_</span><span class="si">{d[next_idx].pos_}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.FOLLOWING_POSTAG.name}</span><span class="s1">_</span><span class="si">{d[next_idx].tag_}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># PARENT_DEP</span>
            <span class="c1"># PARENT_POS</span>
            <span class="c1"># PARENT_POSTAG</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            &quot;Because the syntactic relations form a tree, every word has exactly one head.</span>
<span class="sd">            You can therefore iterate over the arcs in the tree by iterating over the words in the sentence.&quot;</span>
<span class="sd">            https://spacy.io/docs/usage/dependency-parse#navigating</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">head</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">token</span><span class="p">):</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.PARENT_DEP.name}</span><span class="s1">_{token.head.dep_.upper()}&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.PARENT_POS.name}</span><span class="s1">_</span><span class="si">{token.head.pos_}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.PARENT_POSTAG.name}</span><span class="s1">_</span><span class="si">{token.head.tag_}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># CHILD_DEP</span>
            <span class="c1"># CHILD_POS</span>
            <span class="c1"># CHILD_POSTAG</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.CHILD_DEP.name}</span><span class="s1">_{child.dep_.upper()}&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.CHILD_POS.name}</span><span class="s1">_</span><span class="si">{child.pos_}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.CHILD_POSTAG.name}</span><span class="s1">_</span><span class="si">{child.tag_}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">s_features</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">featuresets</span> <span class="o">=</span> <span class="p">[(</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">featurize</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">doc</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">statistics</span> <span class="k">import</span> <span class="n">mean</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">stdev</span>
<span class="n">f_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">featuresets</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stats on number of features per example:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;mean: {mean(f_lengths)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;stdev: {stdev(f_lengths)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;median: {median(f_lengths)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;mode: {mode(f_lengths)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;max: {max(f_lengths)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;min: {min(f_lengths)}&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[16]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Stats on number of features per example:
mean: 22.786088094199737
stdev: 14.556752789753176
median: 22.0
mode: 0
max: 75
min: 0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">featuresets</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[17]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[(Transfer gazpacho to an airtight container; cover and chill until very cold, 4–12 hours.,
  ({}, &#39;pos&#39;)),
 (Add jalapeño and salt and toss to combine.,
  ({&#39;CHILD_DEP_AUX&#39;: 1,
    &#39;CHILD_DEP_CONJ&#39;: 1,
    &#39;CHILD_DEP_DOBJ&#39;: 1,
    &#39;CHILD_DEP_PUNCT&#39;: 1,
    &#39;CHILD_DEP_XCOMP&#39;: 1,
    &#39;CHILD_POSTAG_.&#39;: 1,
    &#39;CHILD_POSTAG_NN&#39;: 1,
    &#39;CHILD_POSTAG_TO&#39;: 1,
    &#39;CHILD_POSTAG_VB&#39;: 2,
    &#39;CHILD_POS_NOUN&#39;: 1,
    &#39;CHILD_POS_PART&#39;: 1,
    &#39;CHILD_POS_PUNCT&#39;: 1,
    &#39;CHILD_POS_VERB&#39;: 2,
    &#39;FOLLOWING_POSTAG_.&#39;: 1,
    &#39;FOLLOWING_POSTAG_NN&#39;: 1,
    &#39;FOLLOWING_POSTAG_TO&#39;: 1,
    &#39;FOLLOWING_POS_NOUN&#39;: 1,
    &#39;FOLLOWING_POS_PART&#39;: 1,
    &#39;FOLLOWING_POS_PUNCT&#39;: 1,
    &#39;PARENT_DEP_CONJ&#39;: 1,
    &#39;PARENT_DEP_ROOT&#39;: 1,
    &#39;PARENT_POSTAG_VB&#39;: 2,
    &#39;PARENT_POS_VERB&#39;: 2,
    &#39;VERB&#39;: 3},
   &#39;pos&#39;))]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>On one run, the above line printed the following featureset:
<code>(Gather foil loosely on top and bake for 1 1/2 hours., ({}, 'pos'))</code></p>
<p>This is because the Spacy.io POS tagger provided this:
   <code>Gather/NNP foil/NN loosely/RB on/IN top/NN and/CC bake/NN for/IN 1 1/2 hours./NNS</code></p>
<p>...with no VERBs tagged, which is incorrect.</p>
<p>"Voting - POS taggers and classifiers" in the <em>Next Steps/Improvements</em> section below is meant to improve on this.</p>
<hr>
<p>Compare to <a href="http://nlp.stanford.edu:8080/corenlp/process">Stanford CoreNLP POS tagger</a>:
   <code>Gather/VB foil/NN loosely/RB on/IN top/JJ and/CC bake/VB for/IN 1 1/2/CD hours/NNS ./.</code></p>
<p>And <a href="http://nlp.stanford.edu:8080/parser/index.jsp">Stanford Parser</a>:
   <code>Gather/NNP foil/VB loosely/RB on/IN top/NN and/CC bake/VB for/IN 1 1/2/CD hours/NNS ./.</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Classification">Classification<a class="anchor-link" href="#Classification">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">featuresets</span><span class="p">)</span>

<span class="n">num_classes</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">split_num</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">num_per_class</span><span class="o">*</span><span class="n">num_classes</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># train and test sets</span>
<span class="n">testing_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">fs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">featuresets</span><span class="p">[:</span><span class="n">split_num</span><span class="p">])]</span>
<span class="n">training_set</span> <span class="o">=</span>  <span class="p">[</span><span class="n">fs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">featuresets</span><span class="p">[</span><span class="n">split_num</span><span class="p">:])]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;# training samples: {len(training_set)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;# test samples: {len(testing_set)}&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[18]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre># training samples: 3669
# test samples: 917
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># decoupling the functionality of nltk.classify.accuracy</span>
<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">gold</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">prob</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">([</span><span class="n">fs</span> <span class="k">for</span> <span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">ll</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gold</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">classify_many</span><span class="p">([</span><span class="n">fs</span> <span class="k">for</span> <span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">ll</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gold</span><span class="p">])</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="p">[</span><span class="n">ll</span> <span class="k">for</span> <span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">ll</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gold</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="n">predicts</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">prob</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="o">==</span> <span class="n">prediction</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="n">predicts</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="o">==</span> <span class="n">prediction</span> <span class="k">for</span> <span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="n">predicts</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">correct</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">correct</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">correct</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note below the use of <code>DummyClassifier</code> to provide a simple sanity check, a baseline of random predictions. <code>stratified</code> means it "generates random predictions by respecting the training set class distribution." (<a href="http://scikit-learn.org/stable/modules/model_evaluation.html#dummy-estimators">http://scikit-learn.org/stable/modules/model_evaluation.html#dummy-estimators</a>)</p>
<blockquote><p>More generally, when the accuracy of a classifier is too close to random, it probably means that something went wrong: features are not helpful, a hyperparameter is not correctly tuned, the classifier is suffering from class imbalance, etc…</p>
</blockquote>
<p>If a classifier can beat the <code>DummyClassifier</code>, it is at least learning something valuable! How valuable is another question...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nltk</span> <span class="k">import</span> <span class="n">NaiveBayesClassifier</span>
<span class="kn">from</span> <span class="nn">nltk.classify.decisiontree</span> <span class="k">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">nltk.classify.scikitlearn</span> <span class="k">import</span> <span class="n">SklearnClassifier</span>

<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="k">import</span> <span class="n">DummyClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="k">import</span> <span class="n">MultinomialNB</span><span class="p">,</span> <span class="n">BernoulliNB</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LogisticRegressionCV</span><span class="p">,</span> <span class="n">SGDClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="k">import</span> <span class="n">SVC</span><span class="p">,</span> <span class="n">LinearSVC</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.calibration</span> <span class="k">import</span> <span class="n">CalibratedClassifierCV</span>

<span class="n">dummy</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">DummyClassifier</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;stratified&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">dummy</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">dummy_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">dummy_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">dummy_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dummy classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">dummy_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="n">nb</span> <span class="o">=</span> <span class="n">NaiveBayesClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">nb_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">nb_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">nb_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NaiveBayes classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">nb_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="n">multinomial_nb</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">MultinomialNB</span><span class="p">())</span>
<span class="n">multinomial_nb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">mnb_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">multinomial_nb</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">mnb_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">mnb_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MultinomialNB classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">mnb_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="n">bernoulli_nb</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">BernoulliNB</span><span class="p">())</span>
<span class="n">bernoulli_nb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">bnb_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">bernoulli_nb</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">bnb_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">bnb_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BernoulliNB classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">bnb_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># ??logistic_regression._clf</span>
<span class="c1">#   sklearn.svm.LinearSVC : learns SVM models using the same algorithm.</span>
<span class="n">logistic_regression</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">LogisticRegressionCV</span><span class="p">())</span>
<span class="n">logistic_regression</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">lr_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">logistic_regression</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">lr_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">lr_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LogisticRegressionCV classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">lr_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># ??sgd._clf</span>
<span class="c1">#    The &#39;log&#39; loss gives logistic regression, a probabilistic classifier.</span>
<span class="c1"># ??linear_svc._clf</span>
<span class="c1">#   can optimize the same cost function as LinearSVC</span>
<span class="c1">#   by adjusting the penalty and loss parameters. In addition it requires</span>
<span class="c1">#   less memory, allows incremental (online) learning, and implements</span>
<span class="c1">#   various loss functions and regularization regimes.</span>
<span class="n">sgd</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">SGDClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">))</span>
<span class="n">sgd</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">sgd_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">sgd</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">sgd_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">sgd_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SGD classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">sgd_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># slow</span>
<span class="c1"># using libsvm with kernel &#39;rbf&#39; (radial basis function)</span>
<span class="n">svc</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">svc</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">svc_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">svc_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">svc_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SVC classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">svc_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># ??linear_svc._clf</span>
<span class="c1">#    Similar to SVC with parameter kernel=&#39;linear&#39;, but implemented in terms of</span>
<span class="c1">#    liblinear rather than libsvm, so it has more flexibility in the choice of</span>
<span class="c1">#    penalties and loss functions and should scale better to large numbers of</span>
<span class="c1">#    samples.</span>
<span class="c1">#    Prefer dual=False when n_samples &gt; n_features.</span>
<span class="c1"># Using CalibratedClassifierCV as wrapper to get predict probabilities (https://stackoverflow.com/a/39712590)</span>
<span class="n">linear_svc</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">CalibratedClassifierCV</span><span class="p">(</span><span class="n">LinearSVC</span><span class="p">(</span><span class="n">dual</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>
<span class="n">linear_svc</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">linear_svc_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">linear_svc</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">linear_svc_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">linear_svc_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LinearSVC classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">linear_svc_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># slower</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">dt_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">dt_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">dt_predict</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DecisionTree classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">dt_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="n">random_forest</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span> <span class="o">=</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">random_forest</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">rf_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">random_forest</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">rf_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">rf_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomForest classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">rf_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[20]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Dummy classifier accuracy percent: 48.74591057797165
NaiveBayes classifier accuracy percent: 68.04798255179935
MultinomialNB classifier accuracy percent: 80.26172300981462
BernoulliNB classifier accuracy percent: 74.2639040348964
LogisticRegressionCV classifier accuracy percent: 84.07851690294439
SGD classifier accuracy percent: 56.706652126499456
SVC classifier accuracy percent: 83.09705561613958
LinearSVC classifier accuracy percent: 83.86041439476554
DecisionTree classifier accuracy percent: 78.29880043620501
RandomForest classifier accuracy percent: 83.6423118865867
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h3 id="SGD:-Multiple-Epochs">SGD: Multiple Epochs<a class="anchor-link" href="#SGD:-Multiple-Epochs">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>sgd</code> classifiers improves with epochs. <code>??sgd._clf</code> tells us that the default number of epochs <code>n_iter</code> is 5. So let's run more epochs. Also not that the training_set shuffle is <code>True</code> by default.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">sgd</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">SGDClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">))</span>
<span class="n">sgd</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">sgd_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">sgd</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">sgd_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">sgd_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;SGDClassifier classifier accuracy percent (epochs: </span><span class="si">{num_epochs}</span><span class="s2">):&quot;</span><span class="p">,</span> <span class="n">sgd_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[21]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>SGDClassifier classifier accuracy percent (epochs: 1000): 84.18756815703381
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Fortunately, 1000 epochs run very quickly! And <code>SGDClassifier</code> performance has improved with more iterations.</p>
<p><em>Also note that we can set <code>warm_start</code> to <code>True</code> if we want to take advantage of online learning and reuse the solution of the previous call.</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h3 id="GridSearch-and-Cross-Validation">GridSearch and Cross-Validation<a class="anchor-link" href="#GridSearch-and-Cross-Validation">&#182;</a></h3><p>Next we perform 1) grid search to find optimal hyperparameters, and 2) cross-validation to evaluate performance over multiple folds of the data (to avoid overfitting).</p>
<p><a href="http://scikit-learn.org/stable/modules/grid_search.html#grid-search">http://scikit-learn.org/stable/modules/grid_search.html#grid-search</a></p>
<p><a href="http://scikit-learn.org/stable/auto_examples/model_selection/plot_nested_cross_validation_iris.html">http://scikit-learn.org/stable/auto_examples/model_selection/plot_nested_cross_validation_iris.html</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nltk.classify.scikitlearn</span> <span class="k">import</span> <span class="n">SklearnClassifier</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">SGDClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="k">import</span> <span class="n">LinearSVC</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.calibration</span> <span class="k">import</span> <span class="n">CalibratedClassifierCV</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># https://stackoverflow.com/a/16388804</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="k">import</span> <span class="n">clone</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">zeros</span>

<span class="k">def</span> <span class="nf">cross_val</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">num_splits</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">original_clf</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_clf</span><span class="p">)</span>
    <span class="n">cvidx</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">num_splits</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>

    <span class="n">nested_acc</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">num_splits</span><span class="p">)</span>
    <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">trainidx</span><span class="p">,</span> <span class="n">testidx</span> <span class="ow">in</span> <span class="n">cvidx</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">_clf</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">original_clf</span><span class="p">)</span>  <span class="c1"># we clone the estimator to make sure that all the folds are independent</span>
        <span class="n">classifier</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">[</span><span class="n">trainidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">trainidx</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">trainidx</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">training_set</span><span class="p">[</span><span class="n">testidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">testidx</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">testidx</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">nested_acc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">debug</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{name}</span><span class="s2"> CV accuracies:&quot;</span><span class="p">,</span> <span class="n">nested_acc</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">nested_acc</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># http://scikit-learn.org/stable/auto_examples/model_selection/plot_grid_search_digits.html#sphx-glr-auto-examples-model-selection-plot-grid-search-digits-py</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LogisticRegression</span>

<span class="c1"># Set the parameters by cross-validation</span>
<span class="n">model_parameters</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;LinearSVC&#39;</span><span class="p">:</span> <span class="p">[{</span>
                        <span class="s1">&#39;loss&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;hinge&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;dual&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">],</span>
                        <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">],</span>
                        <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">],</span>
                        <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;loss&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;squared_hinge&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;dual&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
                        <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">],</span>
                        <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">],</span>
                        <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
                    <span class="p">}]},</span>
                   <span class="p">{</span><span class="s1">&#39;LogisticRegression&#39;</span><span class="p">:</span> <span class="p">[{</span>
                        <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l1&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;dual&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">],</span>
                        <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span>
                        <span class="s1">&#39;solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">]</span>
                   <span class="p">},</span>
                   <span class="p">{</span>
                        <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;dual&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
                        <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span>
                        <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
                        <span class="s1">&#39;solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">]</span>
                   <span class="p">},</span>
                   <span class="p">{</span>
                        <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;dual&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">],</span>
                        <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span>
                        <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
                        <span class="s1">&#39;solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;newton-cg&#39;</span><span class="p">,</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="s1">&#39;sag&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">]</span>
                   <span class="p">}]},</span>
                   <span class="p">{</span><span class="s1">&#39;SGD&#39;</span><span class="p">:</span> <span class="p">[{</span>
                        <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="s1">&#39;elasticnet&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">],</span>
                        <span class="s1">&#39;average&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
                        <span class="s1">&#39;n_iter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span>
                   <span class="p">}]},</span>
                   <span class="p">{</span><span class="s1">&#39;RandomForest&#39;</span><span class="p">:</span> <span class="p">[{</span>
                        <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
                        <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="s1">&#39;entropy&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;log2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                        <span class="s1">&#39;oob_score&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
                   <span class="p">}]}]</span>

<span class="n">score</span> <span class="o">=</span> <span class="s1">&#39;roc_auc&#39;</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_param</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;# </span><span class="si">{model}</span><span class="s2">: Tuning hyper-parameters for </span><span class="si">{score}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;LinearSVC&#39;</span><span class="p">:</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;LogisticRegression&#39;</span><span class="p">:</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;SGD&#39;</span><span class="p">:</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">SGDClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;RandomForest&#39;</span><span class="p">:</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> model needs to be added to the if-block&#39;</span> <span class="o">%</span> <span class="n">model</span><span class="p">)</span>

    <span class="n">grid</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">GridSearchCV</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">model_param</span><span class="p">[</span><span class="n">model</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                       <span class="n">scoring</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameters set found on development set:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">_clf</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">_clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">][</span><span class="n">grid</span><span class="o">.</span><span class="n">_clf</span><span class="o">.</span><span class="n">best_index_</span><span class="p">]</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">_clf</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;std_test_score&#39;</span><span class="p">][</span><span class="n">grid</span><span class="o">.</span><span class="n">_clf</span><span class="o">.</span><span class="n">best_index_</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;roc_auc: </span><span class="si">%0.3f</span><span class="s2"> (+/-</span><span class="si">%0.03f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;LinearSVC&#39;</span><span class="p">:</span>
        <span class="c1"># Wrapping LinearSVC in CalibratedClassifierCV to add support for probability prediction</span>
        <span class="c1"># Note that there is a difference in accuracies between raw GridSearchCV and calibrated GridSearchCV</span>
        <span class="c1"># However, I&#39;m willing to sacrifice the potential &#39;best&#39; result from raw in order to output probabilities</span>
        <span class="n">grid_calibrated</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">CalibratedClassifierCV</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">_clf</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
        <span class="n">grid_calibrated</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
        <span class="n">gridc_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">grid_calibrated</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
        <span class="n">gridc_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">gridc_predict</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{model}</span><span class="s2"> (calibrated) classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">gridc_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">grid_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">grid_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">grid_predict</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{model}</span><span class="s2"> (raw) classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">grid_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># CV after parameter optimization</span>
        <span class="n">cv_acc</span> <span class="o">=</span> <span class="n">cross_val</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">grid_calibrated</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{model}</span><span class="s2"> (calibrated) CV classifier avg accuracy percent:&quot;</span><span class="p">,</span> <span class="n">cv_acc</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">linear_svc_opt</span> <span class="o">=</span> <span class="n">grid_calibrated</span>
        <span class="n">linear_svc_predict</span> <span class="o">=</span> <span class="n">gridc_predict</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">grid_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
        <span class="n">grid_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">grid_predict</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{model}</span><span class="s2"> classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">grid_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># CV after parameter optimization</span>
        <span class="n">cv_acc</span> <span class="o">=</span> <span class="n">cross_val</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{model}</span><span class="s2"> CV classifier avg accuracy percent:&quot;</span><span class="p">,</span> <span class="n">cv_acc</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;LogisticRegression&#39;</span><span class="p">:</span>
            <span class="n">logistic_regression_opt</span> <span class="o">=</span> <span class="n">grid</span>
            <span class="n">lr_predict</span> <span class="o">=</span> <span class="n">grid_predict</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;SGD&#39;</span><span class="p">:</span>
            <span class="n">sgd_opt</span> <span class="o">=</span> <span class="n">grid</span>
            <span class="n">sgd_predict</span> <span class="o">=</span> <span class="n">grid_predict</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;RandomForest&#39;</span><span class="p">:</span>
            <span class="n">random_forest_opt</span> <span class="o">=</span> <span class="n">grid</span>
            <span class="n">rf_predict</span> <span class="o">=</span> <span class="n">grid_predict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> model was not run through Grid Search&#39;</span> <span class="o">%</span> <span class="n">model</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[24]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre># LinearSVC: Tuning hyper-parameters for roc_auc

Best parameters set found on development set:

{&#39;C&#39;: 0.01, &#39;dual&#39;: False, &#39;loss&#39;: &#39;squared_hinge&#39;, &#39;max_iter&#39;: 1000, &#39;penalty&#39;: &#39;l2&#39;, &#39;tol&#39;: 0.001}
roc_auc: 0.908 (+/-0.018)

LinearSVC (calibrated) classifier accuracy percent: 83.42420937840785
LinearSVC (raw) classifier accuracy percent: 83.53326063249727
LinearSVC CV accuracies: [ 0.83387889  0.83383438  0.83396947]
LinearSVC (calibrated) CV classifier avg accuracy percent: 83.3894244566

# LogisticRegression: Tuning hyper-parameters for roc_auc

Best parameters set found on development set:

{&#39;C&#39;: 1.0, &#39;dual&#39;: True, &#39;max_iter&#39;: 100, &#39;penalty&#39;: &#39;l2&#39;, &#39;solver&#39;: &#39;liblinear&#39;, &#39;tol&#39;: 0.0001}
roc_auc: 0.908 (+/-0.016)

LogisticRegression classifier accuracy percent: 84.18756815703381
LogisticRegression CV accuracies: [ 0.837241    0.83701884  0.83670678]
LogisticRegression CV classifier avg accuracy percent: 83.6988874553

# SGD: Tuning hyper-parameters for roc_auc

Best parameters set found on development set:

{&#39;alpha&#39;: 0.001, &#39;average&#39;: False, &#39;n_iter&#39;: 100, &#39;penalty&#39;: &#39;l2&#39;}
roc_auc: 0.910 (+/-0.015)

SGD classifier accuracy percent: 82.98800436205016
SGD CV accuracies: [ 0.83706332  0.83674584  0.83833152]
SGD CV classifier avg accuracy percent: 83.7380223779

# RandomForest: Tuning hyper-parameters for roc_auc

Best parameters set found on development set:

{&#39;criterion&#39;: &#39;entropy&#39;, &#39;max_features&#39;: &#39;auto&#39;, &#39;n_estimators&#39;: 1000, &#39;oob_score&#39;: False}
roc_auc: 0.910 (+/-0.025)

RandomForest classifier accuracy percent: 84.29661941112323
RandomForest CV accuracies: [ 0.9290393   0.92898115  0.92880524]
RandomForest CV classifier avg accuracy percent: 92.8941897105

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="VotingClassifier">VotingClassifier<a class="anchor-link" href="#VotingClassifier">&#182;</a></h3><p>We're going to create an ensemble classifier by letting our top-performing classifiers, which consistently perform with &gt;80% accuracy &mdash; <code>LogisticRegression</code>, <code>LinearSVC</code>, <code>SGD</code>, and <code>RandomForest</code> (excluding <code>SVC</code> due to its slowness) &mdash; vote on each prediction.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">VotingClassifier</span>

<span class="n">voting</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">VotingClassifier</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="n">logistic_regression_opt</span><span class="o">.</span><span class="n">_clf</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;linear_svc&#39;</span><span class="p">,</span> <span class="n">linear_svc_opt</span><span class="o">.</span><span class="n">_clf</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;sgd&#39;</span><span class="p">,</span> <span class="n">sgd_opt</span><span class="o">.</span><span class="n">_clf</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">,</span> <span class="n">random_forest_opt</span><span class="o">.</span><span class="n">_clf</span><span class="p">)</span>
<span class="p">],</span> <span class="n">voting</span><span class="o">=</span><span class="s1">&#39;soft&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">voting</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>

<span class="n">voting_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">voting</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">voting_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">voting_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Soft voting classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">voting_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># CV after parameter optimization</span>
<span class="n">voting_acc</span> <span class="o">=</span> <span class="n">cross_val</span><span class="p">(</span><span class="s2">&quot;Soft voting&quot;</span><span class="p">,</span> <span class="n">voting</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Soft voting CV classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">voting_acc</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[34]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Soft voting classifier accuracy percent: 84.29661941112323
Soft voting CV accuracies: [ 0.89822647  0.898527    0.89559989]
Soft voting CV classifier accuracy percent: 89.7451120722
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Analysis">Analysis<a class="anchor-link" href="#Analysis">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Similarly to the voting model, we're also going to scope analysis down to our top-performing classifiers. We'll include the <code>Voting</code> model itself, and then <code>Dummy</code> as a baseline.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Most-Informative-Features">Most Informative Features<a class="anchor-link" href="#Most-Informative-Features">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># https://stackoverflow.com/a/11140887</span>
<span class="k">def</span> <span class="nf">show_most_informative_features</span><span class="p">(</span><span class="n">vectorizer</span><span class="p">,</span> <span class="n">clf</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">feature_names</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>
    <span class="n">coefs_with_fns</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">feature_names</span><span class="p">))</span>
    <span class="n">top</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coefs_with_fns</span><span class="p">[:</span><span class="nb">round</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="n">coefs_with_fns</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">coef_1</span><span class="p">,</span> <span class="n">fn_1</span><span class="p">),</span> <span class="p">(</span><span class="n">coef_2</span><span class="p">,</span> <span class="n">fn_2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">top</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">%.4f</span><span class="se">\t</span><span class="si">%-15s</span><span class="se">\t\t</span><span class="si">%.4f</span><span class="se">\t</span><span class="si">%-15s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">coef_1</span><span class="p">,</span> <span class="n">fn_1</span><span class="p">,</span> <span class="n">coef_2</span><span class="p">,</span> <span class="n">fn_2</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SGD&#39;</span><span class="p">)</span>
<span class="n">show_most_informative_features</span><span class="p">(</span><span class="n">sgd</span><span class="o">.</span><span class="n">_vectorizer</span><span class="p">,</span> <span class="n">sgd</span><span class="o">.</span><span class="n">_clf</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">)</span>
<span class="n">show_most_informative_features</span><span class="p">(</span><span class="n">logistic_regression</span><span class="o">.</span><span class="n">_vectorizer</span><span class="p">,</span> <span class="n">logistic_regression</span><span class="o">.</span><span class="n">_clf</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[29]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>SGD
	-2.5549	CHILD_DEP_AGENT		2.3775	PARENT_DEP_ADVMOD||CONJ
	-2.3709	CHILD_POSTAG_``		2.2319	CHILD_DEP_DOBJ||XCOMP
	-2.0919	PARENT_DEP_AMOD		2.1958	CHILD_POSTAG_-RRB-
	-1.8619	PARENT_POSTAG_VBZ		1.7032	CHILD_DEP_NPADVMOD
	-1.8443	CHILD_DEP_CSUBJ		1.6896	FOLLOWING_POSTAG_MD
	-1.8137	CHILD_POSTAG_HYPH		1.5639	PARENT_DEP_OPRD
	-1.7267	CHILD_DEP_INTJ 		1.5519	PARENT_POS_PROPN
	-1.6111	PARENT_POSTAG_CD		1.5519	PARENT_POSTAG_NNP

Logistic Regression
	-1.5202	CHILD_DEP_AGENT		1.2352	CHILD_DEP_NPADVMOD
	-1.4173	PARENT_POSTAG_VBZ		1.1783	CHILD_POSTAG_-RRB-
	-1.3431	CHILD_DEP_NSUBJ		1.0003	VERB
	-1.1485	CHILD_POSTAG_HYPH		0.9728	PARENT_POS_PROPN
	-0.9715	CHILD_POS_ADJ  		0.9728	PARENT_POSTAG_NNP
	-0.9480	CHILD_DEP_ATTR 		0.9693	CHILD_DEP_MARK
	-0.9114	CHILD_POSTAG_``		0.9398	PARENT_POSTAG_VB
	-0.8811	CHILD_DEP_CSUBJ		0.8721	CHILD_POSTAG_:
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Note: Because <code>CalibratedClassifierCV</code> has no attribute <code>coef_</code>, we cannot show the most informative features for <code>LinearSVC</code> while it's wrapped. <code>Random Forest</code> and <code>Voting</code> also lack <code>coef_</code>.</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="s2">&quot;JJS&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[30]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>&#39;adjective, superlative&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Negative coefficients</strong>:</p>
<ul>
<li>VERB parents <a href="http://universaldependencies.org/docs/sv/dep/nmod-agent.html"><code>AGENT</code></a>: "used for agents of passive verbs" - interpreting this to mean that <em>existence of passive verbs (i.e., the opposite of active verbs) means negative correlation with it being imperative</em></li>
<li>VERB followed by a <code>WRB</code>: "wh-adverb" (where, when)</li>
<li>VERB is a child of <a href="http://universaldependencies.org/en/dep/amod.html"><code>AMOD</code></a>: "any adjective or adjectival phrase that serves to modify the meaning" of the verb</li>
</ul>
<p><strong>Positive coefficients</strong>:</p>
<ul>
<li>VERB parents a <code>-RRB-</code>: "right round bracket"</li>
<li>VERB is a child of <code>PROPN</code>: "proper noun"</li>
<li>VERB is a child of <code>NNP</code>: "noun, proper singular"</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h4 id="Scikit-Learn-metrics:-Confusion-matrix,-Classification-report,-F1-score,-Log-loss">Scikit Learn metrics: Confusion matrix, Classification report, F1 score, Log loss<a class="anchor-link" href="#Scikit-Learn-metrics:-Confusion-matrix,-Classification-report,-F1-score,-Log-loss">&#182;</a></h4><p><a href="http://scikit-learn.org/stable/modules/model_evaluation.html">http://scikit-learn.org/stable/modules/model_evaluation.html</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">metrics</span>

<span class="k">def</span> <span class="nf">classification_report</span><span class="p">(</span><span class="n">predict</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">predict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prob</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">confusion_matrix</span><span class="p">(</span><span class="n">predict</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">predict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">print_layout</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Layout</span><span class="se">\n</span><span class="s1">[[tn   fp]</span><span class="se">\n</span><span class="s1"> [fn   tp]]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prob</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">log_loss</span><span class="p">(</span><span class="n">predict</span><span class="p">):</span>
    <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">predict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">log_loss</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">roc_auc_score</span><span class="p">(</span><span class="n">predict</span><span class="p">):</span>
    <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">predict</span><span class="p">)</span>
    <span class="c1"># need to convert labels to binary classification of 0 or 1</span>
    <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">([</span><span class="mi">1</span> <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">],</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">precision_recall_curve</span><span class="p">(</span><span class="n">predict</span><span class="p">):</span>
    <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">predict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">],</span> <span class="n">pos_label</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">average_precision_score</span><span class="p">(</span><span class="n">predict</span><span class="p">):</span>
    <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">predict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">average_precision_score</span><span class="p">([</span><span class="mi">1</span> <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">roc_curve</span><span class="p">(</span><span class="n">predict</span><span class="p">):</span>
    <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">predict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">],</span> <span class="n">pos_label</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SGD&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">sgd_predict</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">lr_predict</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LinearSVC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">linear_svc_predict</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">rf_predict</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[32]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>SGD
             precision    recall  f1-score   support

        neg       0.90      0.75      0.82       470
        pos       0.78      0.91      0.84       447

avg / total       0.84      0.83      0.83       917


Logistic Regression
             precision    recall  f1-score   support

        neg       0.89      0.79      0.84       470
        pos       0.80      0.89      0.85       447

avg / total       0.85      0.84      0.84       917


LinearSVC
             precision    recall  f1-score   support

        neg       0.88      0.78      0.83       470
        pos       0.80      0.89      0.84       447

avg / total       0.84      0.83      0.83       917


Random Forest
             precision    recall  f1-score   support

        neg       0.88      0.80      0.84       470
        pos       0.81      0.89      0.85       447

avg / total       0.85      0.84      0.84       917

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Voting&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">voting_predict</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[35]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Voting
             precision    recall  f1-score   support

        neg       0.89      0.79      0.84       470
        pos       0.80      0.89      0.85       447

avg / total       0.85      0.84      0.84       917

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Layout</span><span class="se">\n</span><span class="s1">[[tn   fp]</span><span class="se">\n</span><span class="s1"> [fn   tp]]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SGD&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">sgd_predict</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">lr_predict</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LinearSVC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">linear_svc_predict</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">rf_predict</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[36]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Layout
[[tn   fp]
 [fn   tp]]

SGD
[[353 117]
 [ 39 408]]

Logistic Regression
[[373  97]
 [ 48 399]]

LinearSVC
[[368 102]
 [ 50 397]]

Random Forest
[[377  93]
 [ 51 396]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Voting&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">voting_predict</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[37]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Voting
[[373  97]
 [ 47 400]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The lower the better for <code>log_loss</code>...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;SGD: {log_loss(sgd_predict)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Logistic Regression: {log_loss(lr_predict)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;LinearSVC: {log_loss(linear_svc_predict)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Random Forest: {log_loss(rf_predict)}&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[38]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>SGD: 0.36957712487581706
Logistic Regression: 0.3602890831167405
LinearSVC: 0.36916111074994923
Random Forest: 0.38073002357683455
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Voting: {log_loss(voting_predict)}&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[39]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Voting: 0.3505806495460855
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The higher the better for <code>roc_auc_score</code>...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;SGD: {roc_auc_score(sgd_predict)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Logistic Regression: {roc_auc_score(lr_predict)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;LinearSVC: {roc_auc_score(linear_svc_predict)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Random Forest: {roc_auc_score(rf_predict)}&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[40]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>SGD: 0.9202865438621544
Logistic Regression: 0.9209814841258509
LinearSVC: 0.9181636441525061
Random Forest: 0.9228782902565567
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Voting: {roc_auc_score(voting_predict)}&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[41]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Voting: 0.9323290018563473
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Performance-on-sample-tasks">Performance on sample tasks<a class="anchor-link" href="#Performance-on-sample-tasks">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Mow lawn&quot;</span><span class="p">,</span> <span class="s2">&quot;Mow the lawn&quot;</span><span class="p">,</span> <span class="s2">&quot;Buy new shoes&quot;</span><span class="p">,</span> <span class="s2">&quot;Feed the dog&quot;</span><span class="p">,</span> <span class="s2">&quot;Send report to Kyle&quot;</span><span class="p">,</span> <span class="s2">&quot;Send the report to Kyle&quot;</span><span class="p">,</span> <span class="s2">&quot;Peel the potatoes&quot;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">featurize</span><span class="p">(</span><span class="n">nlp</span><span class="p">(</span><span class="n">task</span><span class="p">))</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">sample_tasks</span><span class="p">]</span>

<span class="n">tasks_dummy</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dummy</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">dummy</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>
<span class="n">tasks_logistic</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">logistic_regression_opt</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">logistic_regression_opt</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>
<span class="n">tasks_linear_svc</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">linear_svc_opt</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">linear_svc_opt</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>
<span class="n">tasks_sgd</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sgd_opt</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">sgd_opt</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>
<span class="n">tasks_rf</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">random_forest_opt</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">random_forest_opt</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>
<span class="n">tasks_voting</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">voting</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">voting</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Dummy: </span><span class="si">{tasks_dummy}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;LogisticRegression: </span><span class="si">{tasks_logistic}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;LinearSVC: </span><span class="si">{tasks_linear_svc}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;SGD: </span><span class="si">{tasks_sgd}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Random Forest: </span><span class="si">{tasks_rf}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Voting: </span><span class="si">{tasks_voting}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[43]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Dummy: [(&#39;neg&#39;, 0.0), (&#39;neg&#39;, 0.0), (&#39;neg&#39;, 0.0), (&#39;neg&#39;, 0.0), (&#39;pos&#39;, 1.0), (&#39;neg&#39;, 0.0), (&#39;pos&#39;, 1.0)]
LogisticRegression: [(&#39;pos&#39;, 0.57862802137868552), (&#39;pos&#39;, 0.82713746377398456), (&#39;pos&#39;, 0.94137130453808182), (&#39;pos&#39;, 0.82713746377398456), (&#39;pos&#39;, 0.72197606789783497), (&#39;pos&#39;, 0.82713746377398456), (&#39;pos&#39;, 0.84117203120422435)]
LinearSVC: [(&#39;pos&#39;, 0.62485948769521327), (&#39;pos&#39;, 0.73801945489589904), (&#39;pos&#39;, 0.8742231132727718), (&#39;pos&#39;, 0.73801945489589904), (&#39;pos&#39;, 0.70967647141483869), (&#39;pos&#39;, 0.73801945489589904), (&#39;pos&#39;, 0.76609305638857117)]
SGD: [(&#39;pos&#39;, 0.60621072131342246), (&#39;pos&#39;, 0.80304033735548375), (&#39;pos&#39;, 0.9300899085422456), (&#39;pos&#39;, 0.80304033735548375), (&#39;pos&#39;, 0.70050625854824256), (&#39;pos&#39;, 0.80304033735548375), (&#39;pos&#39;, 0.82347772218132842)]
Random Forest: [(&#39;pos&#39;, 0.52071951131625149), (&#39;pos&#39;, 0.87285887236391291), (&#39;pos&#39;, 0.74832988482365803), (&#39;pos&#39;, 0.87285887236391291), (&#39;pos&#39;, 0.80143704121964976), (&#39;pos&#39;, 0.87285887236391291), (&#39;pos&#39;, 0.84073885809507198)]

Voting: [(&#39;pos&#39;, 0.56069809800114434), (&#39;pos&#39;, 0.82035364117265086), (&#39;pos&#39;, 0.83252323110236282), (&#39;pos&#39;, 0.82035364117265086), (&#39;pos&#39;, 0.75629257058438037), (&#39;pos&#39;, 0.82035364117265086), (&#39;pos&#39;, 0.81835575359455703)]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Voting-Model:-Curves">Voting Model: Curves<a class="anchor-link" href="#Voting-Model:-Curves">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">prc_thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">voting_predict</span><span class="p">)</span>
<span class="n">average_precision</span> <span class="o">=</span> <span class="n">average_precision_score</span><span class="p">(</span><span class="n">voting_predict</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
         <span class="n">where</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Recall&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;2-class Precision-Recall curve: AUC=</span><span class="si">{0:0.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">average_precision</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[44]:</div>



<div class="output_png output_subarea ">
<img src="/assets/imgs/nlp_classifier/nlp_classifier_70_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[45]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">roc_thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">voting_predict</span><span class="p">)</span>
<span class="n">area</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">voting_predict</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
         <span class="n">where</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Receiving Operating Characteristic: area=</span><span class="si">{0:0.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">area</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[45]:</div>



<div class="output_png output_subarea ">
<img src="/assets/imgs/nlp_classifier/nlp_classifier_71_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Considered a bad idea to actually adjust predictions based on optimal <code>Threshold</code> from holdout test data curves - it's a form of overfitting on the test set: <a href="https://stackoverflow.com/questions/32627926/scikit-changing-the-threshold-to-create-multiple-confusion-matrixes">https://stackoverflow.com/questions/32627926/scikit-changing-the-threshold-to-create-multiple-confusion-matrixes</a> (although using ROC to do this might be ok? or on cross-validated training data? <a href="https://stackoverflow.com/a/35300649">https://stackoverflow.com/a/35300649</a>)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Pickling-the-Voting-Model">Pickling the Voting Model<a class="anchor-link" href="#Pickling-the-Voting-Model">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[47]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Exporting the voting model to model.pkl&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;model.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">voting</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[47]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Exporting the voting model to model.pkl
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># load the model back into memory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Importing the model from model.pkl&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;model.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">loaded_clf</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># predict on a new sample</span>
<span class="n">task_new</span> <span class="o">=</span> <span class="s1">&#39;Buy ice cream&#39;</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;New sample: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">task_new</span><span class="p">))</span>

<span class="c1"># score on the new sample</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">featurize</span><span class="p">(</span><span class="n">nlp</span><span class="p">(</span><span class="n">task_new</span><span class="p">));</span>
<span class="n">predict</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">loaded_clf</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">loaded_clf</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Predicted class is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">predict</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[48]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Importing the model from model.pkl
New sample: Buy ice cream
Predicted class is (&#39;pos&#39;, 0.90561978802951215)
</pre>
</div>
</div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Next-Steps-and-Improvements">Next Steps and Improvements<a class="anchor-link" href="#Next-Steps-and-Improvements">&#182;</a></h2><ol>
<li>Training set may be too specific/not relevant enough (recipe instructions for positive dataset, recipe descriptions+short movie reviews for negative dataset)</li>
<li>Throwing features into a blender - need to understand value of each<ul>
<li>What feature "classes" tend to perform the best/worst?</li>
<li><a href="http://jotterbach.github.io/2016/03/24/Principal_Component_Analysis/">PCA</a>: Reducing dimensionality using most informative feature information</li>
</ul>
</li>
<li>Phrase vectorizations of all 0s - how problematic is this?</li>
<li>Varying feature vector lengths - does this matter?</li>
<li>Voting - POS taggers<ul>
<li><a href="http://scikit-learn.org/stable/modules/ensemble.html">SciKit Learn: Ensembles</a></li>
<li><a href="https://mlwave.com/kaggle-ensembling-guide/">Kaggle Ensembling Guide</a></li>
</ul>
</li>
<li>Combining verb phrases</li>
<li>Look at examples from different quadrants of the confusion matrix - is there something we can learn?<ul>
<li>Same idea with the classification report</li>
</ul>
</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>
<h1 id="Things-abandoned">Things abandoned<a class="anchor-link" href="#Things-abandoned">&#182;</a></h1>
</div>
</div>
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>See the <a href="https://github.com/iconix/nlp-sandbox/blob/master/nlp_classifier.ipynb">original notebook</a> for this section.</p>
</div>
</div>
