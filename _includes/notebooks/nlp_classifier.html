<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="NLP-for-Task-Classification">Notebook<a class="anchor-link" href="#NLP-for-Task-Classification">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Hypothesis</strong>: Part of Speech (POS) tagging and syntactic dependency parsing provides valuable information for classifying imperative phrases. The thinking is that being able to detect imperative phrases will transfer well to detecting tasks and to-dos.</p>
<h4 id="Some-Terminology">Some Terminology<a class="anchor-link" href="#Some-Terminology">&#182;</a></h4><ul>
<li><a href="https://en.wikipedia.org/wiki/Imperative_mood"><em>Imperative mood</em></a> is "used principally for ordering, requesting or advising the listener to do (or not to do) something... also often used for giving instructions as to how to perform a task."</li>
<li><em>Part of speech (POS)</em> is a way of categorizing a word based on its syntactic function.<ul>
<li>The POS tagger from Spacy.io that is used in this notebook differentiates between <a href="https://spacy.io/docs/api/annotation#pos-tagging-english"><em>pos_</em> and <em>tag_</em></a> - <em>POS (pos_)</em> refers to "coarse-grained part-of-speech" like <code>VERB</code>, <code>ADJ</code>, or <code>PUNCT</code>; and <em>POSTAG (tag_)</em> refers to "fine-grained part-of-speech" like <code>VB</code>, <code>JJ</code>, or <code>.</code>.</li>
</ul>
</li>
<li><em>Syntactic dependency parsing</em> is a way of connecting words based on syntactic relationships, <a href="https://spacy.io/docs/api/annotation#dependency-parsing-english">such as</a> <code>DOBJ</code> (direct object), <code>PREP</code> (prepositional modifier), or <code>POBJ</code> (object of preposition).<ul>
<li>Check out the dependency parse of the phrase <a href="https://demos.explosion.ai/displacy/?text=Send%20the%20report%20to%20Kyle%20by%20tomorrow&amp;model=en&amp;cpu=1&amp;cph=1">"Send the report to Kyle by tomorrow"</a> as an example.</li>
</ul>
</li>
</ul>
<h3 id="Proposed-Features">Proposed Features<a class="anchor-link" href="#Proposed-Features">&#182;</a></h3><p>The imperative mood centers around <em>actions</em>, and actions are generally represented in English using verbs. So the features are engineered to also center on the VERB:</p>
<ol>
<li><code>FeatureName.VERB</code>: Does the phrase contain <code>VERB</code>(s) of the tag form <code>VB*</code>?</li>
<li><code>FeatureName.FOLLOWING_POS</code>: Are the words following the <code>VERB</code>(s) of certain parts of speech?</li>
<li><code>FeatureName.FOLLOWING_POSTAG</code>: Are the words following the <code>VERB</code>(s) of certain POS tags?</li>
<li><code>FeatureName.CHILD_DEP</code>: Are the <code>VERB</code>(s) parents of certain syntactic dependencies?</li>
<li><code>FeatureName.PARENT_DEP</code>: Are the <code>VERB</code>(s) children of certain syntactic dependencies?</li>
<li><code>FeatureName.CHILD_POS</code>: Are the syntactic dependencies that the <code>VERB</code>(s) are children of of certain parts of speech?</li>
<li><code>FeatureName.CHILD_POSTAG</code>: Are the syntactic dependencies that the <code>VERB</code>(s) are children of of certain POS tags?</li>
<li><code>FeatureName.PARENT_POS</code>: Are the syntactic dependencies that the <code>VERB</code>(s) parent of certain parts of speech?</li>
<li><code>FeatureName.PARENT_POSTAG</code>: Are the syntactic dependencies that the <code>VERB</code>(s) parent of certain POS tags?</li>
</ol>
<p><strong>Notes:</strong></p>
<ul>
<li>Features 2-9 all depend on feature 1 between <code>True</code>; if <code>False</code>, phrase vectorization will result in all zeroes.</li>
<li>When features 2-9 are applied to actual phrases, they will append identifying informating about the feature in the form of <code>_*</code> (e.g., <code>FeatureName.FOLLOWING_POSTAG_WRB</code>).</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-and-Setup">Data and Setup<a class="anchor-link" href="#Data-and-Setup">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Building-a-recipe-corpus">Building a recipe corpus<a class="anchor-link" href="#Building-a-recipe-corpus">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I wrote and ran <code>epicurious_recipes.py</code>* to scrape Epicurious.com for recipe instructions and descriptions. I then performed some manual cleanup of the script results. Output is in <code>epicurious-pos.txt</code> and <code>epicurious-neg.txt</code>.</p>
<p>* <em>script (very) loosely based off of <a href="https://github.com/benosment/hrecipe-parse">https://github.com/benosment/hrecipe-parse</a></em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Note</strong> that deriving all negative examples in the training set from Epicurious recipe descriptions would result in negative examples that are longer and syntactically more complicated than the positive examples. This is a form of bias.</p>
<p>To (hopefully?) correct for this a bit, I will add the short movie reviews found at <a href="https://pythonprogramming.net/static/downloads/short_reviews/">https://pythonprogramming.net/static/downloads/short_reviews/</a> as more negative examples.</p>
<p>This still feels weird because we're selecting negative examples only from specific categories of text (recipe descriptions, short movie reviews) - just because they're readily available. Further, most positive examples are recipe instructions - also a specific (and not necessarily related to the main "task" category) category of text.</p>
<p>Ultimately though, this recipe corpus is a <strong>stopgap/proof of concept</strong> for a corpus more relevant to tasks later on, so I won't worry further about this for now.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">random</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">pos_data_path</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">+</span> <span class="s1">&#39;/pos.txt&#39;</span>
<span class="n">neg_data_path</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">+</span> <span class="s1">&#39;/neg.txt&#39;</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pos_data_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pos_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">neg_data_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">neg_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pos_data_split</span> <span class="o">=</span> <span class="n">pos_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">neg_data_split</span> <span class="o">=</span> <span class="n">neg_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">num_pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_data_split</span><span class="p">)</span>
<span class="n">num_neg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">neg_data_split</span><span class="p">)</span>

<span class="c1"># 50/50 split between the number of positive and negative samples</span>
<span class="n">num</span> <span class="o">=</span> <span class="n">num_pos</span> <span class="k">if</span> <span class="n">num_pos</span> <span class="o">&lt;</span> <span class="n">num_neg</span> <span class="k">else</span> <span class="n">num_neg</span>

<span class="c1"># shuffle samples</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">pos_data_split</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">neg_data_split</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">pos_data_split</span><span class="p">[:</span><span class="n">num</span><span class="p">]:</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">neg_data_split</span><span class="p">[:</span><span class="n">num</span><span class="p">]:</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="s1">&#39;neg&#39;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Features as defined in the introduction</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="k">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">auto</span>
<span class="k">class</span> <span class="nc">FeatureName</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">VERB</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">FOLLOWING_POS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">FOLLOWING_POSTAG</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">CHILD_DEP</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">PARENT_DEP</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">CHILD_POS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">CHILD_POSTAG</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">PARENT_POS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">PARENT_POSTAG</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h2 id="spaCy.io-for-NLP"><a href="https://spacy.io/">spaCy.io</a> for NLP<a class="anchor-link" href="#spaCy.io-for-NLP">&#182;</a></h2><p><em>Because Stanford CoreNLP is hard to install for Python</em></p>
<p>Found Spacy through an article on <a href="https://www.microsoft.com/developerblog/2016/09/13/training-a-classifier-for-relation-extraction-from-medical-literature/">"Training a Classifier for Relation Extraction from Medical Literature"</a> (<a href="https://github.com/CatalystCode/corpus-to-graph-ml">GitHub</a>)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/assets/imgs/nlp_classifier/nltk_library_comparison.png" alt="NLTK library comparison chart https://spacy.io/docs/api/#comparison" style="width: 400px; margin: 0;"/></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="ch">#!conda config --add channels conda-forge</span>
<span class="c1">#!conda install spacy</span>
<span class="c1">#!python -m spacy download en</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h3 id="Using-the-Spacy-Data-Model-for-NLP">Using the Spacy Data Model for NLP<a class="anchor-link" href="#Using-the-Spacy-Data-Model-for-NLP">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Spacy's sentence segmentation is lacking... <a href="https://github.com/explosion/spaCy/issues/235">https://github.com/explosion/spaCy/issues/235</a>. So each '\n' will start a new Spacy Doc.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">create_spacy_docs</span><span class="p">(</span><span class="n">ll</span><span class="p">):</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="p">[(</span><span class="n">nlp</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">]</span>
    <span class="c1"># collapse noun phrases into single compounds</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">np</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">noun_chunks</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">tag_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ent_type_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dd</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">docs</span> <span class="o">=</span> <span class="n">create_spacy_docs</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h3 id="NLP-output">NLP output<a class="anchor-link" href="#NLP-output">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Tokenization, POS tagging, and dependency parsing happened automatically with the <code>nlp(line)</code> calls above! So let's look at the outputs.</p>
<p><a href="https://spacy.io/docs/usage/data-model">https://spacy.io/docs/usage/data-model</a> and <a href="https://spacy.io/docs/api/doc">https://spacy.io/docs/api/doc</a> will be useful going forward</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sents</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>[Add tofu and gently toss; set aside to marinate.]
[Scatter cheese on top. Finely grate some lemon zest over salad, then slice open lemon and squeeze on some juice.]
[Toss zucchini, vinegar, chopped oregano, and 1/4 cup oil in a medium bowl to combine; season zucchini salsa with salt and pepper.]
[Berry syrup can be made 3 days ahead.]
[Cook, stirring continuously and occasionally scraping the bottom of the pan with the wooden spoon, until the mixture has thickened and coats the spoon with little to no transparency.]
[Remove seeds from remaining 2 tomatoes and cut into 1/4&#34; cubes.]
[Transfer to a cutting board and let cool slightly.]
[Combine grated garlic, lemon juice, and a pinch of salt in a food processor and let sit until the bite in garlic mellows, about 5 minutes.]
[Mix at low speed just until the ingredients come together, about 1 minute.]
[Serve or freeze in an airtight container for up to a week.]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">noun_chunks</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[12]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>[tofu]
[cheese, top, some lemon zest, salad, some juice]
[zucchini, vinegar, oregano, 1/4 cup oil, a medium bowl, salt, pepper]
[Berry syrup]
[Cook, the bottom, the pan, the wooden spoon, the mixture, the spoon, no transparency]
[seeds, 2 tomatoes, 1/4&#34; cubes]
[Transfer, a cutting board]
[garlic, lemon juice, a pinch, salt, a food processor, the bite, garlic mellows]
[Mix, low speed, the ingredients]
[Serve, freeze, an airtight container]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://demos.explosion.ai/displacy">Spacy's dependency graph visualization</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">dep_</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lemma_</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">pos_</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">tag_</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">head</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[13]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Add ROOT add VERB VB Add [tofu, toss, .]
tofu dobj tofu NOUN NN Add [and]
and cc and CCONJ CC tofu []
gently advmod gently ADV RB toss []
toss conj toss VERB VB Add [gently, ;, set]
; punct ; PUNCT : toss []
set acl set VERB VBN toss [aside, marinate]
aside advmod aside ADV RB set []
to aux to PART TO marinate []
marinate advcl marinate VERB VB set [to]
...
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h3 id="Featurization">Featurization<a class="anchor-link" href="#Featurization">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>

<span class="k">def</span> <span class="nf">featurize</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">s_features</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;VB.?&#39;</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">tag_</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># note: not using token.pos == VERB because this also includes BES, HVS, MD tags </span>
            <span class="n">s_features</span><span class="p">[</span><span class="n">FeatureName</span><span class="o">.</span><span class="n">VERB</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># FOLLOWING_POS</span>
            <span class="c1"># FOLLOWING_POSTAG</span>
            <span class="n">next_idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span> <span class="n">next_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.FOLLOWING_POS.name}</span><span class="s1">_</span><span class="si">{d[next_idx].pos_}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.FOLLOWING_POSTAG.name}</span><span class="s1">_</span><span class="si">{d[next_idx].tag_}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># PARENT_DEP</span>
            <span class="c1"># PARENT_POS</span>
            <span class="c1"># PARENT_POSTAG</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            &quot;Because the syntactic relations form a tree, every word has exactly one head.</span>
<span class="sd">            You can therefore iterate over the arcs in the tree by iterating over the words in the sentence.&quot;</span>
<span class="sd">            https://spacy.io/docs/usage/dependency-parse#navigating</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">head</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">token</span><span class="p">):</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.PARENT_DEP.name}</span><span class="s1">_{token.head.dep_.upper()}&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.PARENT_POS.name}</span><span class="s1">_</span><span class="si">{token.head.pos_}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.PARENT_POSTAG.name}</span><span class="s1">_</span><span class="si">{token.head.tag_}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># CHILD_DEP</span>
            <span class="c1"># CHILD_POS</span>
            <span class="c1"># CHILD_POSTAG</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.CHILD_DEP.name}</span><span class="s1">_{child.dep_.upper()}&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.CHILD_POS.name}</span><span class="s1">_</span><span class="si">{child.pos_}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">s_features</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{FeatureName.CHILD_POSTAG.name}</span><span class="s1">_</span><span class="si">{child.tag_}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">s_features</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">featuresets</span> <span class="o">=</span> <span class="p">[(</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">featurize</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">doc</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">statistics</span> <span class="k">import</span> <span class="n">mean</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">stdev</span>
<span class="n">f_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">featuresets</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stats on number of features per example:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;mean: {mean(f_lengths)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;stdev: {stdev(f_lengths)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;median: {median(f_lengths)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;mode: {mode(f_lengths)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;max: {max(f_lengths)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;min: {min(f_lengths)}&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[16]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Stats on number of features per example:
mean: 22.88600697471665
stdev: 14.543271036053682
median: 23.0
mode: 0
max: 75
min: 0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">featuresets</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[17]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[(Add tofu and gently toss; set aside to marinate.,
  ({&#39;CHILD_DEP_ACL&#39;: 1,
    &#39;CHILD_DEP_ADVCL&#39;: 1,
    &#39;CHILD_DEP_ADVMOD&#39;: 2,
    &#39;CHILD_DEP_AUX&#39;: 1,
    &#39;CHILD_DEP_CONJ&#39;: 1,
    &#39;CHILD_DEP_DOBJ&#39;: 1,
    &#39;CHILD_DEP_PUNCT&#39;: 2,
    &#39;CHILD_POSTAG_.&#39;: 1,
    &#39;CHILD_POSTAG_:&#39;: 1,
    &#39;CHILD_POSTAG_NN&#39;: 1,
    &#39;CHILD_POSTAG_RB&#39;: 2,
    &#39;CHILD_POSTAG_TO&#39;: 1,
    &#39;CHILD_POSTAG_VB&#39;: 2,
    &#39;CHILD_POSTAG_VBN&#39;: 1,
    &#39;CHILD_POS_ADV&#39;: 2,
    &#39;CHILD_POS_NOUN&#39;: 1,
    &#39;CHILD_POS_PART&#39;: 1,
    &#39;CHILD_POS_PUNCT&#39;: 2,
    &#39;CHILD_POS_VERB&#39;: 3,
    &#39;FOLLOWING_POSTAG_.&#39;: 1,
    &#39;FOLLOWING_POSTAG_:&#39;: 1,
    &#39;FOLLOWING_POSTAG_NN&#39;: 1,
    &#39;FOLLOWING_POSTAG_RB&#39;: 1,
    &#39;FOLLOWING_POS_ADV&#39;: 1,
    &#39;FOLLOWING_POS_NOUN&#39;: 1,
    &#39;FOLLOWING_POS_PUNCT&#39;: 2,
    &#39;PARENT_DEP_ACL&#39;: 1,
    &#39;PARENT_DEP_CONJ&#39;: 1,
    &#39;PARENT_DEP_ROOT&#39;: 1,
    &#39;PARENT_POSTAG_VB&#39;: 2,
    &#39;PARENT_POSTAG_VBN&#39;: 1,
    &#39;PARENT_POS_VERB&#39;: 3,
    &#39;VERB&#39;: 4},
   &#39;pos&#39;)),
 (Scatter cheese on top. Finely grate some lemon zest over salad, then slice open lemon and squeeze on some juice.,
  ({&#39;CHILD_DEP_ADVMOD&#39;: 1,
    &#39;CHILD_DEP_DOBJ&#39;: 1,
    &#39;CHILD_POSTAG_NN&#39;: 1,
    &#39;CHILD_POSTAG_RB&#39;: 1,
    &#39;CHILD_POS_ADV&#39;: 1,
    &#39;CHILD_POS_NOUN&#39;: 1,
    &#39;FOLLOWING_POSTAG_NN&#39;: 1,
    &#39;FOLLOWING_POS_NOUN&#39;: 1,
    &#39;PARENT_DEP_ROOT&#39;: 1,
    &#39;PARENT_POSTAG_JJ&#39;: 1,
    &#39;PARENT_POS_ADJ&#39;: 1,
    &#39;VERB&#39;: 1},
   &#39;pos&#39;))]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>On one run, the above line printed the following featureset:
<code>(Gather foil loosely on top and bake for 1 1/2 hours., ({}, 'pos'))</code></p>
<p>This is because the Spacy.io POS tagger provided this:
   <code>Gather/NNP foil/NN loosely/RB on/IN top/NN and/CC bake/NN for/IN 1 1/2 hours./NNS</code></p>
<p>...with no VERBs tagged, which is incorrect.</p>
<p>"Voting - POS taggers and classifiers" in the <em>Next Steps/Improvements</em> section below is meant to improve on this.</p>
<hr>
<p>Compare to <a href="http://nlp.stanford.edu:8080/corenlp/process">Stanford CoreNLP POS tagger</a>:
   <code>Gather/VB foil/NN loosely/RB on/IN top/JJ and/CC bake/VB for/IN 1 1/2/CD hours/NNS ./.</code></p>
<p>And <a href="http://nlp.stanford.edu:8080/parser/index.jsp">Stanford Parser</a>:
   <code>Gather/NNP foil/VB loosely/RB on/IN top/NN and/CC bake/VB for/IN 1 1/2/CD hours/NNS ./.</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Classification">Classification<a class="anchor-link" href="#Classification">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">featuresets</span><span class="p">)</span>

<span class="n">split_num</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">num</span><span class="o">*</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># train and test sets</span>
<span class="n">testing_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">fs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">featuresets</span><span class="p">[:</span><span class="n">split_num</span><span class="p">])]</span>
<span class="n">training_set</span> <span class="o">=</span>  <span class="p">[</span><span class="n">fs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">featuresets</span><span class="p">[</span><span class="n">split_num</span><span class="p">:])]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;# training samples: {len(training_set)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;# test samples: {len(testing_set)}&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[18]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre># training samples: 3670
# test samples: 918
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># decoupling the functionality of nltk.classify.accuracy</span>
<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">gold</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">prob</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">([</span><span class="n">fs</span> <span class="k">for</span> <span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">ll</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gold</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">classify_many</span><span class="p">([</span><span class="n">fs</span> <span class="k">for</span> <span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">ll</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gold</span><span class="p">])</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="p">[</span><span class="n">ll</span> <span class="k">for</span> <span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">ll</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gold</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="n">predicts</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">prob</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="o">==</span> <span class="n">prediction</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="n">predicts</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="o">==</span> <span class="n">prediction</span> <span class="k">for</span> <span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="n">predicts</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">correct</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">correct</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">correct</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note below the use of <code>DummyClassifier</code> to provide a simple sanity check, a baseline of random predictions. <code>stratified</code> means it "generates random predictions by respecting the training set class distribution." (<a href="http://scikit-learn.org/stable/modules/model_evaluation.html#dummy-estimators">http://scikit-learn.org/stable/modules/model_evaluation.html#dummy-estimators</a>)</p>
<blockquote><p>More generally, when the accuracy of a classifier is too close to random, it probably means that something went wrong: features are not helpful, a hyperparameter is not correctly tuned, the classifier is suffering from class imbalance, etc…</p>
</blockquote>
<p>If a classifier can beat the <code>DummyClassifier</code>, it is at least learning something valuable! How valuable is another question...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nltk</span> <span class="k">import</span> <span class="n">NaiveBayesClassifier</span>
<span class="kn">from</span> <span class="nn">nltk.classify.decisiontree</span> <span class="k">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">nltk.classify.scikitlearn</span> <span class="k">import</span> <span class="n">SklearnClassifier</span>

<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="k">import</span> <span class="n">DummyClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="k">import</span> <span class="n">MultinomialNB</span><span class="p">,</span> <span class="n">BernoulliNB</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">SGDClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="k">import</span> <span class="n">SVC</span><span class="p">,</span> <span class="n">LinearSVC</span><span class="p">,</span> <span class="n">NuSVC</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">RandomForestClassifier</span>

<span class="n">dummy</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">DummyClassifier</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;stratified&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">dummy</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">dummy_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">dummy_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">dummy_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dummy classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">dummy_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="n">nb</span> <span class="o">=</span> <span class="n">NaiveBayesClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">nb_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">nb_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">nb_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NaiveBayes classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">nb_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="n">multinomial_nb</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">MultinomialNB</span><span class="p">())</span>
<span class="n">multinomial_nb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">mnb_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">multinomial_nb</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">mnb_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">mnb_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MultinomialNB classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">mnb_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="n">bernoulli_nb</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">BernoulliNB</span><span class="p">())</span>
<span class="n">bernoulli_nb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">bnb_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">bernoulli_nb</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">bnb_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">bnb_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BernoulliNB classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">bnb_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># ??logistic_regression._clf</span>
<span class="c1">#   sklearn.svm.LinearSVC : learns SVM models using the same algorithm.</span>
<span class="n">logistic_regression</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">())</span>
<span class="n">logistic_regression</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">lr_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">logistic_regression</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">lr_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">lr_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LogisticRegression classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">lr_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># ??sgd._clf</span>
<span class="c1">#    The &#39;log&#39; loss gives logistic regression, a probabilistic classifier.</span>
<span class="c1"># ??linear_svc._clf</span>
<span class="c1">#   can optimize the same cost function as LinearSVC</span>
<span class="c1">#   by adjusting the penalty and loss parameters. In addition it requires</span>
<span class="c1">#   less memory, allows incremental (online) learning, and implements</span>
<span class="c1">#   various loss functions and regularization regimes.</span>
<span class="n">sgd</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">SGDClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">))</span>
<span class="n">sgd</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">sgd_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">sgd</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">sgd_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">sgd_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SGD classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">sgd_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># slow</span>
<span class="c1"># using libsvm with kernel &#39;rbf&#39; (radial basis function)</span>
<span class="n">svc</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">svc</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">svc_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">svc_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">svc_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SVC classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">svc_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># ??linear_svc._clf</span>
<span class="c1">#    Similar to SVC with parameter kernel=&#39;linear&#39;, but implemented in terms of</span>
<span class="c1">#    liblinear rather than libsvm, so it has more flexibility in the choice of</span>
<span class="c1">#    penalties and loss functions and should scale better to large numbers of</span>
<span class="c1">#    samples.</span>
<span class="c1">#    Prefer dual=False when n_samples &gt; n_features.</span>
<span class="n">linear_svc</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">LinearSVC</span><span class="p">(</span><span class="n">dual</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">linear_svc</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">linear_svc_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">linear_svc</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">linear_svc_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">linear_svc_predict</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LinearSVC classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">linear_svc_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># slower</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">dt_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">dt_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">dt_predict</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DecisionTree classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">dt_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="n">random_forest</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span> <span class="o">=</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">random_forest</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">rf_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">random_forest</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">rf_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">rf_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomForest classifier accuracy percent:&quot;</span><span class="p">,</span> <span class="n">rf_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[20]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Dummy classifier accuracy percent: 50.76252723311547
NaiveBayes classifier accuracy percent: 67.42919389978213
MultinomialNB classifier accuracy percent: 79.41176470588235
BernoulliNB classifier accuracy percent: 75.92592592592592
LogisticRegression classifier accuracy percent: 83.00653594771242
SGD classifier accuracy percent: 81.59041394335512
SVC classifier accuracy percent: 81.48148148148148
LinearSVC classifier accuracy percent: 83.76906318082789
DecisionTree classifier accuracy percent: 79.30283224400871
RandomForest classifier accuracy percent: 81.91721132897604
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h3 id="SGD:-Multiple-Epochs">SGD: Multiple Epochs<a class="anchor-link" href="#SGD:-Multiple-Epochs">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>sgd</code> classifiers improves with epochs. <code>??sgd._clf</code> tells us that the default number of epochs <code>n_iter</code> is 5. So let's run more epochs. Also not that the training_set shuffle is <code>True</code> by default.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">sgd</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">SGDClassifier</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">))</span>
<span class="n">sgd</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
<span class="n">sgd_predict</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">sgd</span><span class="p">,</span> <span class="n">testing_set</span><span class="p">)</span>
<span class="n">sgd_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">sgd_predict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;SGDClassifier classifier accuracy percent (epochs: </span><span class="si">{num_epochs}</span><span class="s2">):&quot;</span><span class="p">,</span> <span class="n">sgd_accuracy</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[21]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>SGDClassifier classifier accuracy percent (epochs: 1000): 83.00653594771242
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Fortunately, 1000 epochs run very quickly! And <code>SGDClassifier</code> performance has improved with more iterations.</p>
<p><em>Also note that we can set <code>warm_start</code> to <code>True</code> if we want to take advantage of online learning and reuse the solution of the previous call.</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Analysis">Analysis<a class="anchor-link" href="#Analysis">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We're going to scope analysis down to our top-performing classifiers, which consistently perform with &gt;80% accuracy: <code>LogisticRegression</code>, <code>SVC</code>, <code>LinearSVC</code>, <code>SGD</code>, and <code>RandomForest</code>.</p>
<p>We'll also include <code>Dummy</code> as a baseline.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Note</strong>: I considered omitting <code>LinearSVC</code> since we have <code>SVC</code> also performing with high accuracy, and since <code>LinearSVC</code> does not provide probability estimates I rely on a lot during this analysis. However, <code>LinearSVC</code> is much faster than <code>SVC</code> and is meant to "scale better to large numbers of samples."</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Most-Informative-Features">Most Informative Features<a class="anchor-link" href="#Most-Informative-Features">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># https://stackoverflow.com/a/11140887</span>
<span class="k">def</span> <span class="nf">show_most_informative_features</span><span class="p">(</span><span class="n">vectorizer</span><span class="p">,</span> <span class="n">clf</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">feature_names</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>
    <span class="n">coefs_with_fns</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">feature_names</span><span class="p">))</span>
    <span class="n">top</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coefs_with_fns</span><span class="p">[:</span><span class="nb">round</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="n">coefs_with_fns</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">coef_1</span><span class="p">,</span> <span class="n">fn_1</span><span class="p">),</span> <span class="p">(</span><span class="n">coef_2</span><span class="p">,</span> <span class="n">fn_2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">top</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">%.4f</span><span class="se">\t</span><span class="si">%-15s</span><span class="se">\t\t</span><span class="si">%.4f</span><span class="se">\t</span><span class="si">%-15s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">coef_1</span><span class="p">,</span> <span class="n">fn_1</span><span class="p">,</span> <span class="n">coef_2</span><span class="p">,</span> <span class="n">fn_2</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SGD&#39;</span><span class="p">)</span>
<span class="n">show_most_informative_features</span><span class="p">(</span><span class="n">sgd</span><span class="o">.</span><span class="n">_vectorizer</span><span class="p">,</span> <span class="n">sgd</span><span class="o">.</span><span class="n">_clf</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">)</span>
<span class="n">show_most_informative_features</span><span class="p">(</span><span class="n">logistic_regression</span><span class="o">.</span><span class="n">_vectorizer</span><span class="p">,</span> <span class="n">logistic_regression</span><span class="o">.</span><span class="n">_clf</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LinearSVC&#39;</span><span class="p">)</span>
<span class="n">show_most_informative_features</span><span class="p">(</span><span class="n">linear_svc</span><span class="o">.</span><span class="n">_vectorizer</span><span class="p">,</span> <span class="n">linear_svc</span><span class="o">.</span><span class="n">_clf</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[23]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>SGD
	-2.4606	CHILD_DEP_AGENT		2.5138	CHILD_POSTAG_-RRB-
	-2.4429	FOLLOWING_POSTAG_-RRB-		1.9397	CHILD_DEP_ADVMOD||XCOMP
	-2.4134	CHILD_POSTAG_``		1.8529	PARENT_DEP_CSUBJ
	-2.3004	CHILD_POSTAG_HYPH		1.7568	CHILD_DEP_DOBJ||XCOMP
	-2.1355	CHILD_DEP_INTJ 		1.6884	VERB
	-2.0063	FOLLOWING_POSTAG_WRB		1.5498	FOLLOWING_POSTAG_RB
	-1.9546	PARENT_DEP_PCOMP		1.4023	PARENT_DEP_ADVMOD||CONJ
	-1.8537	PARENT_POSTAG_VBZ		1.3969	CHILD_DEP_POBJ

Logistic Regression
	-1.9269	CHILD_DEP_AGENT		1.8322	CHILD_POSTAG_-RRB-
	-1.9033	CHILD_POSTAG_HYPH		1.3047	VERB
	-1.6845	PARENT_POSTAG_VBZ		1.2598	CHILD_DEP_NPADVMOD
	-1.4534	CHILD_DEP_INTJ 		1.1426	FOLLOWING_POSTAG_RB
	-1.4403	FOLLOWING_POSTAG_-RRB-		1.1084	PARENT_POS_PROPN
	-1.4358	CHILD_DEP_NSUBJ		1.1084	PARENT_POSTAG_NNP
	-1.4301	PARENT_DEP_PCOMP		1.0633	CHILD_POSTAG_MD
	-1.4123	CHILD_POSTAG_``		1.0621	CHILD_DEP_ADVCL

LinearSVC
	-1.3935	CHILD_POSTAG_``		1.2202	CHILD_DEP_ADVMOD||XCOMP
	-1.3363	FOLLOWING_POSTAG_-RRB-		1.2070	CHILD_DEP_POBJ
	-1.0491	CHILD_DEP_AGENT		1.0620	CHILD_POSTAG_-RRB-
	-0.9386	FOLLOWING_POSTAG_WRB		1.0486	PARENT_DEP_CSUBJ
	-0.8731	CHILD_DEP_INTJ 		0.9969	CHILD_POSTAG_RBS
	-0.8702	CHILD_POSTAG_HYPH		0.9537	CHILD_DEP_DOBJ||XCOMP
	-0.8037	PARENT_POSTAG_PRP		0.8780	PARENT_DEP_NUMMOD
	-0.8037	PARENT_POS_PRON		0.7642	VERB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Note: Because <code>SVC</code> is using the nonlinear RBF kernel, we cannot show the most informative features (<code>coef_ is only available when using a linear kernel</code>). The same applies for <code>Random Forest</code>.</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="s2">&quot;JJS&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[24]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>&#39;adjective, superlative&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Negative coefficients</strong>:</p>
<ul>
<li>VERB parents <a href="http://universaldependencies.org/docs/sv/dep/nmod-agent.html"><code>AGENT</code></a>: "used for agents of passive verbs" - interpreting this to mean that <em>existence of passive verbs (i.e., the opposite of active verbs) means negative correlation with it being imperative</em></li>
<li>VERB followed by a <code>WRB</code>: "wh-adverb" (where, when)</li>
<li>VERB is a child of <a href="http://universaldependencies.org/en/dep/amod.html"><code>AMOD</code></a>: "any adjective or adjectival phrase that serves to modify the meaning" of the verb</li>
</ul>
<p><strong>Positive coefficients</strong>:</p>
<ul>
<li>VERB parents a <code>-RRB-</code>: "right round bracket"</li>
<li>VERB is a child of <code>PROPN</code>: "proper noun"</li>
<li>VERB is a child of <code>NNP</code>: "noun, proper singular"</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>Random Forest</code> has another built-in way of determining "feature importance".</p>
<p><strong>TODO</strong>: How to maps feature #s to feature names?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># http://scikit-learn.org/stable/auto_examples/ensemble/plot_forest_importances.html</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">std</span><span class="p">,</span> <span class="n">argsort</span>

<span class="n">importances</span> <span class="o">=</span> <span class="n">random_forest</span><span class="o">.</span><span class="n">_clf</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">std</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">random_forest</span><span class="o">.</span><span class="n">_clf</span><span class="o">.</span><span class="n">estimators_</span><span class="p">],</span>
             <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">num_features</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">random_forest</span><span class="o">.</span><span class="n">_clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">)</span>

<span class="c1"># Plot the feature importances of the forest</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Feature importances&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_features</span><span class="p">),</span> <span class="n">importances</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span>
       <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">std</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_features</span><span class="p">),</span> <span class="n">indices</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_features</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_features</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">. feature </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">indices</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">importances</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">f</span><span class="p">]]))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[25]:</div>



<div class="output_png output_subarea ">
<img src="/assets/imgs/nlp_classifier/nlp_classifier_51_0.png">
</div>

</div>

<div class="output_area">

<div class="prompt output_prompt">Out[25]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>1. feature 32 (0.130005)
2. feature 243 (0.044240)
3. feature 238 (0.039566)
4. feature 98 (0.035817)
5. feature 107 (0.022575)
6. feature 76 (0.022413)
7. feature 91 (0.021481)
8. feature 104 (0.020507)
9. feature 70 (0.019955)
10. feature 11 (0.018632)
11. feature 264 (0.017018)
12. feature 47 (0.015088)
13. feature 23 (0.015034)
14. feature 92 (0.013961)
15. feature 109 (0.013490)
16. feature 54 (0.013486)
17. feature 12 (0.013276)
18. feature 86 (0.013001)
19. feature 63 (0.012677)
20. feature 99 (0.012374)
...
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<br>
<h4 id="Scikit-Learn-metrics:-Confusion-matrix,-Classification-report,-F1-score,-Log-loss">Scikit Learn metrics: Confusion matrix, Classification report, F1 score, Log loss<a class="anchor-link" href="#Scikit-Learn-metrics:-Confusion-matrix,-Classification-report,-F1-score,-Log-loss">&#182;</a></h4><p><a href="http://scikit-learn.org/stable/modules/model_evaluation.html">http://scikit-learn.org/stable/modules/model_evaluation.html</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">metrics</span>

<span class="k">def</span> <span class="nf">classification_report</span><span class="p">(</span><span class="n">predict</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">predict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prob</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">confusion_matrix</span><span class="p">(</span><span class="n">predict</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">predict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">print_layout</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Layout</span><span class="se">\n</span><span class="s1">[[tn   fp]</span><span class="se">\n</span><span class="s1"> [fn   tp]]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prob</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">log_loss</span><span class="p">(</span><span class="n">predict</span><span class="p">):</span>
    <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">predict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">log_loss</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">roc_auc_score</span><span class="p">(</span><span class="n">predict</span><span class="p">):</span>
    <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">predict</span><span class="p">)</span>
    <span class="c1"># need to convert labels to binary classification of 0 or 1</span>
    <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">([</span><span class="mi">1</span> <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">],</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SGD&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">sgd_predict</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">lr_predict</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SVC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">svc_predict</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LinearSVC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">linear_svc_predict</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">rf_predict</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[27]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>SGD
             precision    recall  f1-score   support

        neg       0.90      0.75      0.82       472
        pos       0.78      0.91      0.84       446

avg / total       0.84      0.83      0.83       918


Logistic Regression
             precision    recall  f1-score   support

        neg       0.89      0.77      0.82       472
        pos       0.79      0.89      0.84       446

avg / total       0.84      0.83      0.83       918


SVC
             precision    recall  f1-score   support

        neg       0.85      0.77      0.81       472
        pos       0.78      0.86      0.82       446

avg / total       0.82      0.81      0.81       918


LinearSVC
             precision    recall  f1-score   support

        neg       0.89      0.78      0.83       472
        pos       0.79      0.90      0.84       446

avg / total       0.84      0.84      0.84       918


Random Forest
             precision    recall  f1-score   support

        neg       0.86      0.78      0.82       472
        pos       0.79      0.86      0.82       446

avg / total       0.82      0.82      0.82       918

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Layout</span><span class="se">\n</span><span class="s1">[[tn   fp]</span><span class="se">\n</span><span class="s1"> [fn   tp]]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SGD&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">sgd_predict</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">lr_predict</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SVC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">svc_predict</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LinearSVC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">linear_svc_predict</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">rf_predict</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[28]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Layout
[[tn   fp]
 [fn   tp]]

SGD
[[355 117]
 [ 39 407]]

Logistic Regression
[[363 109]
 [ 47 399]]

SVC
[[365 107]
 [ 63 383]]

LinearSVC
[[366 106]
 [ 43 403]]

Random Forest
[[367 105]
 [ 61 385]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The lower the better for <code>log_loss</code>...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;SGD: {log_loss(sgd_predict)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Logistic Regression: {log_loss(lr_predict)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;SVC: {log_loss(svc_predict)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Random Forest: {log_loss(rf_predict)}&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[29]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>SGD: 0.37847249143305395
Logistic Regression: 0.3731162798963883
SVC: 0.4150758412082994
Random Forest: 0.39579833325412017
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The higher the better for <code>roc_auc_score</code>...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;SGD: {roc_auc_score(sgd_predict)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Logistic Regression: {roc_auc_score(lr_predict)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;SVC: {roc_auc_score(svc_predict)}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Random Forest: {roc_auc_score(rf_predict)}&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[30]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>SGD: 0.9158955308961009
Logistic Regression: 0.9168170935623623
SVC: 0.8879588812039219
Random Forest: 0.9088888044387019
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Note: We cannot compute <code>log_loss</code> or <code>roc_auc_score</code> for <code>LinearSVC</code> because it does not provide probability estimates.</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Performance-on-sample-tasks">Performance on sample tasks<a class="anchor-link" href="#Performance-on-sample-tasks">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Mow lawn&quot;</span><span class="p">,</span> <span class="s2">&quot;Mow the lawn&quot;</span><span class="p">,</span> <span class="s2">&quot;Buy new shoes&quot;</span><span class="p">,</span> <span class="s2">&quot;Feed the dog&quot;</span><span class="p">,</span> <span class="s2">&quot;Send report to Kyle&quot;</span><span class="p">,</span> <span class="s2">&quot;Send the report to Kyle&quot;</span><span class="p">,</span> <span class="s2">&quot;Peel the potatoes&quot;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">featurize</span><span class="p">(</span><span class="n">nlp</span><span class="p">(</span><span class="n">task</span><span class="p">))</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">sample_tasks</span><span class="p">]</span>

<span class="n">tasks_dummy</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dummy</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">dummy</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>
<span class="n">tasks_logistic</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">logistic_regression</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">logistic_regression</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>
<span class="n">tasks_svc</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">svc</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">svc</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>
<span class="n">tasks_linear_svc</span> <span class="o">=</span> <span class="n">linear_svc</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="n">tasks_sgd</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sgd</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">sgd</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>
<span class="n">tasks_rf</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">random_forest</span><span class="o">.</span><span class="n">classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">random_forest</span><span class="o">.</span><span class="n">prob_classify_many</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Dummy: </span><span class="si">{tasks_dummy}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;LogisticRegression: </span><span class="si">{tasks_logistic}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;SVC: </span><span class="si">{tasks_svc}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;LinearSVC: </span><span class="si">{tasks_linear_svc}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;SGD: </span><span class="si">{tasks_sgd}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Random Forest: </span><span class="si">{tasks_rf}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[31]:</div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Dummy: [(&#39;neg&#39;, 0.0), (&#39;neg&#39;, 0.0), (&#39;neg&#39;, 0.0), (&#39;neg&#39;, 0.0), (&#39;pos&#39;, 1.0), (&#39;neg&#39;, 0.0), (&#39;pos&#39;, 1.0)]
LogisticRegression: [(&#39;pos&#39;, 0.59993632091708504), (&#39;pos&#39;, 0.80545738462427463), (&#39;pos&#39;, 0.90904984569308278), (&#39;pos&#39;, 0.80545738462427463), (&#39;pos&#39;, 0.85428416471513524), (&#39;pos&#39;, 0.80545738462427463), (&#39;pos&#39;, 0.82428633915248184)]
SVC: [(&#39;pos&#39;, 0.79790817731030483), (&#39;pos&#39;, 0.74224643977964966), (&#39;pos&#39;, 0.85309553545012395), (&#39;pos&#39;, 0.74224643977964966), (&#39;pos&#39;, 0.82893669789024926), (&#39;pos&#39;, 0.74224643977964966), (&#39;pos&#39;, 0.80199263468059634)]
LinearSVC: [&#39;pos&#39;, &#39;pos&#39;, &#39;pos&#39;, &#39;pos&#39;, &#39;pos&#39;, &#39;pos&#39;, &#39;pos&#39;]
SGD: [(&#39;pos&#39;, 0.59646047671669478), (&#39;pos&#39;, 0.85159259765683115), (&#39;pos&#39;, 0.93425820756426969), (&#39;pos&#39;, 0.85159259765683115), (&#39;pos&#39;, 0.90840726546647588), (&#39;pos&#39;, 0.85159259765683115), (&#39;pos&#39;, 0.86340530996514875)]
Random Forest: [(&#39;pos&#39;, 0.5399701926070386), (&#39;pos&#39;, 0.92400000000000004), (&#39;pos&#39;, 0.84232587787459112), (&#39;pos&#39;, 0.92400000000000004), (&#39;pos&#39;, 0.8786342592592592), (&#39;pos&#39;, 0.92400000000000004), (&#39;pos&#39;, 0.8998685446009389)]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Note: <code>LinearSVC</code> is not implemented to provide probability estimates (<a href="https://github.com/scikit-learn/scikit-learn/issues/4820">https://github.com/scikit-learn/scikit-learn/issues/4820</a>)</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Next-Steps-and-Improvements">Next Steps and Improvements<a class="anchor-link" href="#Next-Steps-and-Improvements">&#182;</a></h2><ol>
<li>Training set may be too specific/not relevant enough (recipe instructions for positive dataset, recipe descriptions+short movie reviews for negative dataset)</li>
<li>Throwing features into a blender - need to understand value of each<ul>
<li>What feature "classes" tend to perform the best/worst?</li>
<li><a href="http://jotterbach.github.io/2016/03/24/Principal_Component_Analysis/">PCA</a>: Reducing dimensionality using most informative feature information</li>
</ul>
</li>
<li>Phrase vectorizations of all 0s - how problematic is this?</li>
<li>Varying feature vector lengths - does this matter?</li>
<li>Voting - POS taggers and classifiers<ul>
<li>Ensembles (<a href="http://scikit-learn.org/stable/modules/ensemble.html">http://scikit-learn.org/stable/modules/ensemble.html</a>)</li>
</ul>
</li>
<li>Combining verb phrases</li>
<li>Cross validation, grid search</li>
<li>Look at examples from different quadrants of the confusion matrix - is there something we can learn?<ul>
<li>Same idea with the classification report</li>
</ul>
</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>
<h1 id="Things-abandoned">Things abandoned<a class="anchor-link" href="#Things-abandoned">&#182;</a></h1>
</div>
</div>
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>See the <a href="https://github.com/iconix/nlp-sandbox/blob/master/nlp_classifier.ipynb">original notebook</a> for this section.</p>
</div>
</div>
